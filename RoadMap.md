# CHTL 项目路线图

本文档概述了 CHTL 项目的开发和重构路线。该路线图遵循测试驱动开发（TDD）的原则，旨在通过分阶段的方法，逐步、稳定地实现 CHTL 语言的全部功能。

## 第一阶段：核心编译器基础设施

此阶段的目标是搭建项目的基础架构，为后续的语言功能开发奠定坚实的基础。

- [x] **项目设置**
    - [x] 初始化 CMake 构建系统
    - [x] 配置 `.gitignore` 文件以排除构建产物和不必要的文件
    - [x] 根据 `CHTL.md` 建议创建项目目录结构 (`CHTL/`, `CHTLJS/`, `Test/` 等)
- [x] **基础工具库**
    - [x] 实现字符串处理工具
    - [ ] 实现文件系统操作工具
    - [x] 为所有工具库功能编写单元测试
- [x] **CHTL 词法分析器 (Lexer)**
    - [x] 定义所有 CHTL 词法单元 (Token)
    - [x] 实现能够将 CHTL 源代码分解为词法单元序列的词法分析器
    - [x] 编写全面的词法分析器测试
- [x] **CHTL 语法分析器 (Parser) 与 AST**
    - [x] 设计抽象语法树 (AST) 节点来表示语言的基本结构（元素、文本、属性）
    - [x] 实现一个能够构建基础 AST 的递归下降语法分析器
    - [x] 为核心语法结构编写单元测试
- [x] **基础代码生成器 (Generator)**
    - [x] 实现一个能够遍历 AST 并生成等效 HTML 的代码生成器
    - [x] 编写针对代码生成的集成测试
- [x] **构建与测试自动化**
    - [x] 集成 Google Test 作为测试框架
    - [x] 编写 Python 构建脚本以简化 `configure`, `build`, `test` 流程
- [ ] **编译器改进 (待办)**
    - [ ] **健壮的错误处理**: 在 `Parser` 中实现详细的错误报告，而不是静默失败。
    - [ ] **高效的 `peek()`**: 优化 `Lexer::peek()` 的实现，以避免不必要的对象复制。
    - [ ] **高级样式解析**: 将 `style` 块的内容解析为具体的 CSS 规则，而不仅仅是字符串。

## 第二阶段：核心 CHTL 语言功能

在基础架构之上，此阶段将专注于实现 CHTL 的静态 HTML 生成功能。

- [x] **基本节点与属性**
    - [x] 支持元素节点 (`div {}`)
    - [x] 支持文本节点 (`text {}` 和 `text: "..."`)
    - [x] 支持属性 (`id: "box"`)
    - [x] 支持字面量（无引号、单引号、双引号）
    - [x] 支持 CE 对等式 (`:` 和 `=` 等价)
- [x] **注释**
    - [x] 实现 `//` 和 `/**/` 注释的忽略
    - [x] 实现 `#` 注释的解析和生成
- [x] **模板系统 (`[Template]`)**
    - [x] 实现样式组模板 (`@Style`)
    - [x] 实现元素模板 (`@Element`)
    - [x] 实现变量组模板 (`@Var`)
    - [x] 实现模板的组合继承
- [x] **原始嵌入 (`[Origin]`)**
    - [x] 支持 `@Html`, `@Style`, `@JavaScript` 的原始代码嵌入
    - [x] 支持带名原始嵌入
- [x] **导入系统 (`[Import]`)**
    - [x] 实现对 CHTL, HTML, CSS, JS 文件的基础导入功能

## 第三阶段：CHTL CSS 特性

此阶段将实现 CHTL 强大的 CSS 相关功能。

- [ ] **局部样式块 (`style {}`)**
    - [x] 支持在元素内部定义内联样式
    - [ ] 实现自动化类名 / ID 添加
    - [ ] 实现上下文推导 (`&`)
- [ ] **CSS 表达式**
    - [ ] 实现属性算术运算 (`width: 100px + 50px`)
    - [ ] 实现属性条件表达式 (`width > 50px ? "red" : "blue"`)
    - [ ] 实现引用属性 (`box.width`)
- [ ] **全局样式块增强**
    - [ ] 将属性运算等功能扩展至全局样式块（可能通过 CSS 预处理器）

## 第四阶段：高级 CHTL 功能

此阶段将实现 CHTL 更高级、更灵活的语言特性。

- [ ] **自定义系统 (`[Custom]`)**
    - [ ] 实现自定义样式组、元素和变量组
    - [ ] 实现特例化操作（如 `delete`, `insert`）
- [ ] **命名空间 (`[Namespace]`)**
    - [ ] 实现命名空间的定义与使用
    - [ ] 处理命名空间冲突与合并
- [ ] **约束 (`except`)**
    - [ ] 实现精确约束和类型约束
- [ ] **配置组 (`[Configuration]`)**
    - [ ] 实现语言关键字的自定义
    - [ ] 实现其他编译行为的配置
- [ ] **模块化 (CMOD)**
    - [ ] 设计并实现 CMOD 模块的打包和解包机制
    - [ ] 实现 CMOD 模块的导入和依赖管理

## 第五阶段：CHTL JS 集成与动态特性

此阶段专注于打通 CHTL 与 CHTL JS 之间的桥梁，并实现动态特性。

- [ ] **盐桥 (SharedCore)**
    - [ ] 设计并实现 CHTL 与 CHTL JS 编译器之间的数据共享与通信机制
- [ ] **局部脚本块 (`script {}`)**
    - [ ] 实现将局部脚本块内容传递给 CHTL JS 编译器进行处理
- [ ] **响应式值**
    - [ ] 实现对 `$jsVariable$` 语法的解析与绑定
- [ ] **动态条件渲染**
    - [ ] 基于响应式值实现动态的条件渲染

## 第六阶段：CHTL JS 编译器

此阶段将独立开发 CHTL JS 编译器，以处理所有脚本相关的功能。

- [ ] **CHTL JS 编译器基础架构**
    - [ ] 设置 CHTL JS 的词法分析器、语法分析器和代码生成器
- [ ] **核心功能**
    - [ ] 实现增强选择器 (`{{selector}}`)
    - [ ] 实现增强监听器 (`Listen {}`, `&->`)
    - [ ] 实现事件委托 (`Delegate {}`)
- [ ] **高级功能**
    - [ ] 实现动画 (`Animate {}`)
    - [ ] 实现路由 (`Router {}`)
    - [ ] 实现虚对象 (`Vir`)
- [ ] **模块化 (CJMOD)**
    - [ ] 设计并实现 CJMOD API
    - [ ] 实现 CJMOD 模块的打包、导入和管理

## 第七阶段：工具链与生态

此阶段将完善项目周边的工具，提升开发者体验。

- [ ] **命令行工具 (CLI)**
    - [ ] 实现一个功能完善的命令行编译器
    - [ ] 提供编译、监视、打包等功能
- [ ] **VSCode IDE 插件**
    - [ ] 开发支持代码高亮、格式化、智能提示等功能的 VSCode 插件
- [ ] **官方模块**
    - [ ] 开发 `Chtholly` 和 `Yuigahama` 官方模块
- [ ] **文档**
    - [ ] 编写详细的用户文档和 API 文档

---
*此路线图将随着项目的进展而动态更新。*
